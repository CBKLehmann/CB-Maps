<link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet" rel="preload" as="font" crossorigin="anonymous">

<div class="structure">
  <div class="floating-menu" anvil-drop-here anvil-slot=" .floating-menu" id="info">
  </div>
  <div class="nav-holder">
    <div class="left-nav anvil-measure-this" anvil-slot-repeat="left-nav" anvil-drop-container=">.anvil-container">
    </div>
    <div class="left-nav-placeholder anvil-designer-only" anvil-if-slot-empty="left-nav" anvil-drop-slot="left-nav">
      <div class="prompt">To add a sidebar, drop a ColumnPanel here.</div>
    </div>
    <div class="content">
      <div anvil-slot-repeat="default" class="anvil-measure-this"></div>
      <div id="darkBackground" class="darkBackground">
      	<div id="setHomeAddress" class="setHomeAddress">
        <form class='setHomeAddressForm' id='inputForm'>
          <p id="text">
            Found following Address with less than 10 Meters Distance to set Marker: 
            <br>
            <b>
            Beispielheim Beispielissimus
            <br>
            Am Beipielweg 35, 23754 Beispielstadt
            </b>
            <br>
          	Do you want to mark the address as your marker address ?
          </p>
          <button class='setHomeAddressButton' type='button' value='yes'>Yes</button>
          <button class='setHomeAddressButton' type='button' value='no'>No</button>
        </form>
      </div>
      </div>
      <div class="placeholder drop-here" anvil-if-slot-empty="default" anvil-drop-slot="default">Drop a ColumnPanel here.</div>
    </div>
  </div>
  <div class="nav-shield"></div>
</div>

<script>
  
  let response = 'none';
  
  function hideSidebar() {
    var ln = $('.structure > .nav-holder > .left-nav');
    ln.animate({left: -ln.outerWidth()}, function() {
      ln.removeClass("in-transition shown").addClass("hidden");
      $('.nav-shield').removeClass("shown");
      $(window).trigger('resize');
    });
  }
  function showSidebar() {
    var ln = $('.structure > .nav-holder > .left-nav');
    $('.nav-shield').addClass("shown");
    ln.addClass("shown").removeClass("hidden").css({left: "-100%"}).css({left: -ln.outerWidth()}).animate({left: 0}, function() {
      ln.removeClass("in-transition");
    });
    $(window).trigger('resize');
  }
  $('.sidebar-toggle, .nav-shield').off('click').on('click', function() {
    var ln = $('.structure > .nav-holder > .left-nav');
    if (ln.is(":visible") || $('.nav-shield').is(".shown")) {
      hideSidebar();
    } else if(!ln.is(":empty")) {
      showSidebar();
    }
  });
  $('.left-nav').off('click').on('click', 'a, button', function() {
    if ($('.nav-shield').is(":visible")) {
      $('.nav-shield').trigger('click');
    }
  });
  
  function hide_show_Popup() {
    
    let popup = document.getElementsByClassName('static-popup')
    if (popup[0].style.display === 'none') {
   		for(const e of popup) {
    		e.style.display = 'flex';
        }
    }else {
    	for(const e of popup) {
    		e.style.display = 'none';
    	}
    }
  }
  
  function show_mun_info(html) {
  
    document.getElementById('info').innerHTML = html
    document.getElementById('info').style.display = 'block'
    
  }
  
  function hide_mun_info() {
    
    document.getElementById('info').style.display = 'none'
    
  }
  
  function open_tab(html) {
    
    var tab = window.open('about:blank', '_blank');
    tab.document.write(html);
    tab.document.close();
    
  }
  
  function addHomeAddress(data) {
    document.getElementById('darkBackground').style.display = 'block'
    document.getElementById('text').innerHTML = `Found the following Object with less than 10 meters distance to set Marker:<br><b>${data[0].name}</b><br>Do you want to mark the Object as your marker address ?`
    document.querySelectorAll('.setHomeAddressButton').forEach(item => {
      item.addEventListener('click', event => {
        response = event.path[0].value
        document.getElementById('darkBackground').style.display = 'none'
      })
    })
  }
  
  function getResponse() {
    return(response)
  }
  
  function resetResponse() {
    response = 'none'
  }
  
  function addData(topic, marker_coords) {
    complete = document.getElementById('setHomeAddress')
    
    if (topic === 'nursing_homes') {
      complete.innerHTML = `<p id="text">Do you want to add additional Informations for your address in ${topic} ?</p><br><form id="inputForm"><label>name<input type="text" id="name" name="name"></label><br><label>no. of beds<input type="text" id="nob" name="nob"></label><br><label>single rooms<input type="text" id="sr" name="sr"></label><br><label>double rooms<input type="text" id="dr" name="dr"></label><br><label>patients<input type="text" id="patients" name="patients"></label><br><label>occupancy<input type="text" id="occupancy" name="occupancy"></label><br><label>year of construction<input type="text" id="yoc" name="yoc"></label><br><label>status<input type="text" id="status" name="status"></label><br><label>operator<input type="text" id="operator" name="operator"></label><br><label>invest cost per day<input type="text" id="icpd" name="icpd"></label><br><label>mdk grade<input type="text" id="mdkg" name="mdkg"></label></form><button class='setHomeDataButton' type='button' value='save'>Save</button><button class='setHomeDataButton' type='button' value='dismiss'>Dismiss</button>`
    } else if (topic === 'assisted_living') {
      complete.innerHTML = `<p id="text">Do you want to add additional Informations for your address in ${topic} ?</p><br><form id="inputForm"><label>name<input type="text" id="name" name="name"></label><br><label>operator<input type="text" id="operator" name="operator"></label><br><label>type<input type="text" id="type" name="type"></label><br><label>city<input type="text" id="city" name="city"></label><br><label>status<input type="text" id="status" name="status"></label><br><label>no. of apts.<input type="text" id="noa" name="noa"></label></form><button class='setHomeDataButton' type='button' value='save'>Save</button><button class='setHomeDataButton' type='button' value='dismiss'>Dismiss</button>`
    }
    form = document.getElementById('inputForm')
    document.getElementById('darkBackground').style.display = 'block'
    document.querySelectorAll('.setHomeDataButton').forEach(item => {
      item.addEventListener('click', event => {
        if (event.target.value !== 'dismiss') {
          let data
          if (topic === 'nursing_homes') {
           data = [{
          	'name': event.path[1].childNodes[2][0].value,
          	'platz_voll_pfl': event.path[1].childNodes[2][1].value,
          	'ez': event.path[1].childNodes[2][2].value,
          	'dz': event.path[1].childNodes[2][3].value,
          	'anz_vers_pat': event.path[1].childNodes[2][4].value,
          	'occupancy': event.path[1].childNodes[2][5].value,
          	'baujahr': event.path[1].childNodes[2][6].value,
          	'status': event.path[1].childNodes[2][7].value,
          	'betreiber': event.path[1].childNodes[2][8].value,
          	'invest': event.path[1].childNodes[2][9].value,
          	'mdk_note': event.path[1].childNodes[2][10].value,
            'coords': marker_coords
           }, 0]
          } else {
            data = {
              'name': event.path[1].childNodes[2][0].value,
              'operator': event.path[1].childNodes[2][1].value,
              'type': event.path[1].childNodes[2][2].value,
              'city': event.path[1].childNodes[2][3].value,
              'status': event.path[1].childNodes[2][4].value,
              'noa': event.path[1].childNodes[2][5].value,
              'coords': marker_coords
          	}
          } 
          response = data 
      	} else {
          response = 'dismiss'
        }
        document.getElementById('darkBackground').style.display = 'none'
      })
    })
  }
</script> 